name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        compiler: [gcc, clang]
        
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Build with ${{ matrix.compiler }}
      run: ${{ matrix.compiler }} -Wall -Wextra -o hello hello.c
      
    - name: Test program
      run: |
        ./hello
        # Verify exit code is 0
        if [ $? -eq 0 ]; then
          echo "✓ Program exited successfully"
        else
          echo "✗ Program failed"
          exit 1
        fi
        
    - name: Build optimized
      run: ${{ matrix.compiler }} -O2 -Wall -Wextra -o hello_opt hello.c
      
    - name: Test optimized build
      run: ./hello_opt
      
    - name: Build with strict flags (GCC only)
      if: matrix.compiler == 'gcc'
      run: gcc -Wall -Wextra -Wpedantic -Wformat=2 -Wconversion -Wsign-conversion -Werror -o hello_strict hello.c
      
    - name: Test strict build (GCC only)
      if: matrix.compiler == 'gcc'
      run: ./hello_strict
